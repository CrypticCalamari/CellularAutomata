<script>
var CA = CA || {};

CA.PopulationRule = (function() {
    return {
        reduce: function( town ) {
            var reduction = 0;
            
            for (var i = 0; i < town.length; i++) {
                if (town[i]) {
                    reduction += Math.pow( 2, town[i].state );
                }
                else {
                    reduction += Math.pow( 2, 0 );
                }
            }
            return reduction;
        },
        test: function( filter, reduction ) {
            return filter.reduction === reduction;
        },
        getFilter: function( town, state ) {
            var s = state || 0;
            var filter = {};
            filter.reduction = CA.PopulationRule.reduce( town );
            filter.nextState = s;
            
            return filter;
        },
        getRandomFilter: function( numStates ) {
            // Stub
        }
    };
})();

console.log('PopulationRule.html processed');
</script>
